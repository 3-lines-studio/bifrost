package main

import (
	"embed"
	"log"
	"net/http"

	"github.com/3-lines-studio/bifrost"
)

//go:embed all:.bifrost
var bifrostFS embed.FS

func main() {
	r, err := bifrost.New(bifrost.WithAssetsFS(bifrostFS))
	if err != nil {
		log.Fatalf("Failed to create renderer: %v", err)
	}
	defer r.Stop()

	app := r.NewPage("./pages/home.tsx", bifrost.WithClientOnly())

	router := http.NewServeMux()
	router.Handle("/", app)

	assetRouter := http.NewServeMux()
	bifrost.RegisterAssetRoutes(assetRouter, r, router)

	addr := ":8080"
	log.Printf("Server running on http://localhost%s", addr)
	if err := http.ListenAndServe(addr, assetRouter); err != nil {
		log.Fatal(err)
	}
}
